<html>
  <head>
    <script src="../dist/comfy.min.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      // https://twitchapps.com/tokengen/
      // user:read:email chat:edit chat:read channel:read:redemptions channel:manage:redemptions
      (async () => {
        const channel = "instafluff";
        const clientId = "r6b6h6qgvtg9jmr8rfvdn3oovgjij7";
        const twitchAuth = "37wix2dpcsmd2s84h4wxfuxhy9tq6c";
        ComfyJS.Init( channel, twitchAuth );
          let channelRewards = await ComfyJS.GetChannelRewards( clientId, true );
          console.log( channelRewards );
          // Clear Managed Custom Rewards
          for( let i = 0; i < channelRewards.length; i++ ) {
              let deleted = await ComfyJS.DeleteChannelReward( clientId, channelRewards[ i ].id );
              console.log( "Deleted:", deleted );
          }
          // Create New Custom Rewards
          let customReward = await ComfyJS.CreateChannelReward( clientId, {
              title: "Test Reward",
              prompt: "TEST PROMPT!",
              cost: 1,
              is_enabled: true,
              background_color: "#00E5CB",
              is_user_input_required: false,
              is_max_per_stream_enabled: false,
              max_per_stream: 0,
              is_max_per_user_per_stream_enabled: false,
              max_per_user_per_stream: 0,
              is_global_cooldown_enabled: false,
              global_cooldown_seconds: 0,
              should_redemptions_skip_request_queue: true
          } );
          console.log( customReward );
          // Update Custom Reward
          customReward = await ComfyJS.UpdateChannelReward( clientId, customReward.id, {
              title: "Test Reward (Updated)",
              prompt: "Hmmm",
              cost: 2,
              is_enabled: true,
              background_color: "#00E5CB"
          } );
          console.log( customReward );
          ComfyJS.onCommand = ( user, command, message, flags, extra ) => {
            if( flags.broadcaster && command == "test" ) {
              console.log( "!test was typed in chat" );
            }
          }
          ComfyJS.onChat = ( user, message, flags, self, extra ) => {
            console.log( user + ":", message );
          }
          ComfyJS.onReward = async ( user, reward, cost, extra ) => {
              console.log( user + " redeemed " + reward + " for " + cost );
              if( reward === customReward.title ) {
                  await ComfyJS.DeleteChannelReward( clientId, customReward.id );
                  console.log( "Deleted!" );
              }
          }
      })();
    </script>
  </body>
</html>
